# Data Engineering Mini Project ğŸš€

## ğŸ“Œ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

Ğ£Ñ‡ĞµĞ±Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ end-to-end data pipeline, Ğ²ĞºĞ»ÑÑ‡Ğ°ÑÑ‰Ğ¸Ğ¹:

- **Kafka** â€” Ğ±Ñ€Ğ¾ĞºĞµÑ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
- **PostgreSQL** â€” Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (OLTP/Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°).
- **MinIO** â€” S3-ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ (Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ/Ğ±ÑĞºĞ°Ğ¿Ñ‹).
- **Apache Flink** â€” Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸.
- **Apache Airflow** â€” Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ETL Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
- **Producer** â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ ÑÑ‚Ğ°Ğ²Ğ¾Ğº (Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹).
- **Consumer** â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Â«ÑÑ‹Ñ€Ñ‹Ñ…Â» ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ğ² Postgres.
- **Flink Jobs** â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº.

## âš™ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```mermaid
flowchart LR
    subgraph PRODUCER["Producer"]
        P1["producer.py"]
    end

    subgraph KAFKA["Kafka"]
        T1["bets topic"]
    end

    subgraph FLINK["Flink Cluster"]
        J1["job_top_games.py"]
        J2["job_avg_bet.py"]
        J3["job_bet_status.py"]
        J4["job_active_users.py"]
    end

    subgraph CONSUMER["Consumer"]
        C1["all_bets_consumer.py"]
        C2["top_games_consumer.py"]
    end

    subgraph STORAGE["Data Storage"]
        DB[(PostgreSQL)]
        S3[(MinIO / S3)]
    end

    subgraph AIRFLOW["Airflow"]
        DAG1["all_bets_exporter_dag.py"]
    end

    P1 --> T1
    T1 --> C1 --> DB
    T1 --> C2 --> DB
    T1 --> J1 --> DB
    T1 --> J2 --> DB
    T1 --> J3 --> DB
    T1 --> J4 --> DB
    DB --> DAG1 --> S3
```

- **producer** Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ñ… Ğ² Kafka (`bets` topic`).
- **Flink** Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ°Ğ³Ñ€ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ² Postgres.
- **consumer** ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑÑ‹Ñ€Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ğ² Postgres Ğ´Ğ»Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°.
- **Postgres** Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸, Ğ° **MinIO** â€” Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ¼Ğ¿Ğ¾Ğ²/Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.
- **airflow** ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ²Ñ‹Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ¸Ğ· `bets` Ğ² S3 (MinIO) Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ **Parquet**, Ğ¿Ğ¾Ğ¼ĞµÑ‡Ğ°Ñ Ğ¸Ñ… ĞºĞ°Ğº `exported=true`.

## ğŸ“‚ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
project/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ airflow/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ dags/
â”‚   â”‚   â””â”€â”€ all_bets_exporter_dag.py
â”‚   â””â”€â”€ exporters/
â”‚       â”œâ”€â”€ all_bets_exporter.py
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ consumer/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ consumers/
â”‚       â”œâ”€â”€ all_bets_consumer.py
â”‚       â””â”€â”€ top_games_consumer.py

â”œâ”€â”€ flink/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ flink-conf.yml
â”‚   â”œâ”€â”€ artifacts/
â”‚   â””â”€â”€ jobs/
â”‚       â”œâ”€â”€ job_active_users.py
â”‚       â”œâ”€â”€ job_avg_bet.py
â”‚       â”œâ”€â”€ job_bet_status.py
â”‚       â””â”€â”€ job_top_games.py
â”‚
â”œâ”€â”€ postgres-init/
â”‚   â””â”€â”€ init.sql
â”‚
â”œâ”€â”€ producer/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ producer.py
â”‚
â””â”€â”€ topic-init/
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ create_topic.py
```

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### 1. ĞŸĞ¾Ğ´Ğ½ÑÑ‚ÑŒ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ

```bash
docker-compose up -d
```

### 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Kafka topic

```bash
docker-compose run --rm topic-init python create_topic.py
```

### 3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Flink jobs

```bash
docker exec -it flink-jobmanager ./bin/flink run -py /opt/flink/jobs/job_top_games.py
docker exec -it flink-jobmanager ./bin/flink run -py /opt/flink/jobs/job_avg_bet.py
docker exec -it flink-jobmanager ./bin/flink run -py /opt/flink/jobs/job_bet_status.py
docker exec -it flink-jobmanager ./bin/flink run -py /opt/flink/jobs/job_active_users.py
```

### 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹

ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Postgres:

```bash
docker exec -it postgres psql -U admin -d betsdb
```

Ğ˜ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:

```sql
SELECT * FROM bet_stats LIMIT 10;
```

## ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸

- ğŸ® Ğ¢Ğ¾Ğ¿ Ğ¸Ğ³Ñ€ Ğ¿Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ñƒ ÑÑ‚Ğ°Ğ²Ğ¾Ğº (`job_top_games.py`)
- ğŸ’° Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ ÑÑ‚Ğ°Ğ²ĞºĞ¸ (`job_avg_bet.py`)
- ğŸ“ˆ ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ (`job_bet_status.py`)
- ğŸ‘¤ ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (`job_active_users.py`)

## ğŸ› ï¸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸

- Python 3.10+ (Producer/Consumer/Flink jobs)
- Apache Kafka (event streaming)
- PostgreSQL (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ)
- Apache Flink (stream processing)
- MinIO (S3-compatible storage)
- Docker + Docker Compose (Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ)

---
